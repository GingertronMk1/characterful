#!/usr/bin/env sh

. ./.env

DOCKER_PROFILE_SETTING=''

if [ -z "${GITHUB_ACTIONS}" ]; then
  DOCKER_PROFILE_SETTING='--profile local'
fi

echo "${DOCKER_PROFILE_SETTING}"

mkdir -p "$(dirname "$SQLITE_LOCATION")" \
  && echo '' > "$SQLITE_LOCATION" \
  && docker compose up -d --build "${DOCKER_PROFILE_SETTING}" --remove-orphans \
  && docker compose exec app composer install \
  && docker compose exec app ./bin/console doctrine:migrations:migrate -n \
  && docker compose exec node npm install \
  && docker compose exec node npm run dev \
  && echo "Up!"
